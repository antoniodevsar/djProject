{% extends "base.html" %}

{% load i18n %}

{% block title %}{% trans "Projects" %}{% endblock %}
{% block body_class %}projects{% endblock %}

{% block main %}

<div class="yui3-u-1-6">
     <div id="projects-menu" class="column">
     	<h2>{% trans "Menu"%}</h2>
     	<ul>
     	<li><a href="{% url projects_project_new %}" title="">{% trans "Create Project" %}</a></li>
     	</ul>
     </div>
</div>
<div class="yui3-u-1-4" id="projects-column">
     <div id="projects-list" class="column">
     <h2>{% trans "Projects"%}</h2>
     	<div id="projects-container">
     		
     		{% for member in membership %}
     			{% with member.project as project %}
     			<div >
     				<span class="project-link" data-project="{{ project.id }}"><a href="#">{{ project.name }}</a></span>
     				<ul>
     					{% for sprint in project.sprint_set.all %}
	     					<li>
	     						<a href="">{{ sprint.name }}</a>
	     					</li>
	     				{% endfor %}
	     					<li><a href="">{% trans "Backlog" %}</a></li>
     				</ul>
     			</div>
     			{% endwith %}
     		{% endfor %}
     		
     	</div>
     </div>
</div>
<div class="yui3-u-1-3">
     <div id="projects-tasks" class="column">
     <h2>{% trans "Tasks"%}</h2>
     	<div id="projects-tasks-container" class="table">
		</div>
		<span>&nbsp;</span>
     </div>
</div>
<div class="yui3-u-1-4">
     <div id="projects-side" class="column">
     <h2>{% trans "Side"%}</h2>
     </div>
</div>
{% endblock %}


{% block footer_js %}
<script src="http://js.pusherapp.com/1.8/pusher.min.js" type="text/javascript"></script>
<script type="text/javascript">
// Enable pusher logging - don't include this in production
Pusher.log = function(message) {
    if (window.console && window.console.log) window.console.log(message);
};
   	
// Flash fallback logging - don't include this in production
{% if debug %}
WEB_SOCKET_DEBUG = true;
{% endif %} 
</script> 

<script src="{{ STATIC_URL }}js/projects.js"></script>
<script type="text/javascript">
var pusher = new Pusher('93d0509ce62dd993b05a');
var channel = pusher.subscribe('{{ user.username }}');
channel.bind('task_created', function(data) {
	//window.app.addTask(new window.Task({task: data.task}));
	//window.tasks.add([data.task]);
	window.tasks.fetch();
}); 
channel.bind('task_updated', function(data) {
	//var task = window.tasks.get(data.task.id);
	window.tasks.fetch();
});
channel.bind('project_created', function(data) {
	//fast trick
	$("#projects-column").load("/projects/ #projects-list");
});
</script>
{% endblock %}

